<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WATCHA SPORTS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Clappr -->
<script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/clappr/clappr-level-selector-plugin@latest/dist/level-selector.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cdnbye@latest/dist/hlsjs-p2p-engine.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cdnbye@latest/dist/clappr-plugin.min.js"></script>
<style>
  html, body {
    margin: 0;
    height: 100%;
    background: #000;
    font-family: Arial, sans-serif;
    color: #fff;
  }
  #player-wrapper {
    width: 100%;
    height: 100%;
    position: relative;
  }
  /* ðŸ”´ YouTube-style Live Counter */
  #viewer-counter {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.7);
    padding: 6px 14px;
    border-radius: 20px;
    font-size: 14px;
    font-weight: bold;
    display: flex;
    align-items: center;
    gap: 8px;
  }
  #viewer-counter .live-dot {
    width: 10px;
    height: 10px;
    background: red;
    border-radius: 50%;
    animation: blink 1s infinite;
  }
  @keyframes blink {
    0%, 50%, 100% { opacity: 1; }
    25%, 75% { opacity: 0; }
  }
</style>
</head>
<body>
<div id="player-wrapper">
  <div id="viewer-counter">
    <div class="live-dot"></div>
    <span>Live Â· <span id="liveViewers">0</span> Watching</span>
  </div>
</div>
<div>
  ðŸ‘€ Live Viewers: <span id="viewersCount">0</span>
</div>
<!-- Clappr Init -->
<script>
  var source = 'https://live.helloxsports.xyz/hls/test.m3u8';
  var player = new Clappr.Player({
      source: source,
      parentId: "#player-wrapper",
      autoPlay: true,
      height: "100%",
      width: "100%",
      plugins: [LevelSelector, CDNByeClapprPlugin],
      watermark: "",
      watermarkLink: "https://hellosports.live",
      watermarkPosition: "top-right",
      levelSelectorConfig: {
          labels: { '360p': '', '480p': '', '720p': '', '1080p': '' },
          labelCallback: (levelName, level) => ${level.height}p
      },
      playback: {
          hlsjsConfig: {
              p2pConfig: {
                  live: true,
                  logLevel: 'debug'
              }
          }
      }
  });
</script>
<!-- Firebase (separate module) -->
<script type="module">
import { getDatabase, ref, onValue, set, serverTimestamp, push, onDisconnect, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
const firebaseConfig = {
  apiKey: "AIzaSyAOCB5-mOq3j22bSyQGkOG1uO6Q-sejPGo",
  authDomain: "fire-9e9e1.firebaseapp.com",
  databaseURL: "https://fire-9e9e1-default-rtdb.firebaseio.com",
  projectId: "fire-9e9e1",
  storageBucket: "fire-9e9e1.firebasestorage.app",
  messagingSenderId: "228308733237",
  appId: "1:228308733237:web:ea379f622b9128b798907c",
  measurementId: "G-SRNVZJJ3X2"
};
// Init Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
// Reference to live viewers
const viewersRef = ref(db, "liveViewers");
// Add current viewer
const newViewerRef = push(viewersRef);
set(newViewerRef, {
  joinedAt: serverTimestamp()
});
// âŒ Remove this viewer when they disconnect
onDisconnect(newViewerRef).remove();
// Count viewers
onValue(viewersRef, (snapshot) => {
  const count = snapshot.size;  // snapshot.size works for DataSnapshots in v9
  document.getElementById("viewersCount").innerText = count;
});
</script>
</body>
</html>
