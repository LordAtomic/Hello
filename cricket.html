<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>WATCHA SPORTS</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- Clappr -->
<script src="https://cdn.jsdelivr.net/npm/clappr@latest/dist/clappr.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/clappr/clappr-level-selector-plugin@latest/dist/level-selector.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cdnbye@latest/dist/hlsjs-p2p-engine.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cdnbye@latest/dist/clappr-plugin.min.js"></script>
<style>
  html, body {
    margin: 0;
    height: 100%;
    background: #000;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    color: #fff;
  }
  #player-wrapper {
    width: 100%;
    height: 100%;
    position: relative;
  }
  
  /* üé® Enhanced Glassmorphism Live Counter */
  #viewer-counter {
    position: absolute;
    top: 16px;
    left: 16px;
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    padding: 8px 16px;
    border-radius: 25px;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 
                0 4px 16px rgba(0, 0, 0, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
    z-index: 1000;
    transition: all 0.3s ease;
    user-select: none;
  }
  
  #viewer-counter:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-1px);
    box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4), 
                0 6px 20px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
  }
  
  /* üî¥ iOS-style Live Dot */
  #viewer-counter .live-dot {
    width: 8px;
    height: 8px;
    background: #ff3b30;
    border-radius: 50%;
    animation: iosLiveBlink 2s ease-in-out infinite;
    box-shadow: 0 0 8px rgba(255, 59, 48, 0.6),
                0 0 16px rgba(255, 59, 48, 0.4);
  }
  
  @keyframes iosLiveBlink {
    0%, 100% { 
      opacity: 1; 
      transform: scale(1);
      box-shadow: 0 0 8px rgba(255, 59, 48, 0.6), 0 0 16px rgba(255, 59, 48, 0.4);
    }
    50% { 
      opacity: 0.7; 
      transform: scale(0.95);
      box-shadow: 0 0 12px rgba(255, 59, 48, 0.8), 0 0 20px rgba(255, 59, 48, 0.6);
    }
  }
  
  /* üëÅÔ∏è Eye Icon for Viewer Count */
  .eye-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    margin-right: 4px;
  }
  
  .eye-icon svg {
    width: 16px;
    height: 16px;
    fill: currentColor;
    opacity: 0.9;
  }
  
  /* Enhanced Bottom Counter */
  #bottom-counter {
    position: absolute;
    bottom: 20px;
    right: 20px;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    padding: 10px 16px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 500;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    gap: 6px;
    z-index: 1000;
  }
  
  #viewersCount {
    font-weight: 700;
    color: #00d4ff;
  }
  
  #liveViewers {
    font-weight: 700;
    color: #ffffff;
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    #viewer-counter {
      top: 12px;
      left: 12px;
      padding: 6px 12px;
      font-size: 13px;
    }
    
    #bottom-counter {
      bottom: 16px;
      right: 16px;
      padding: 8px 12px;
      font-size: 12px;
    }
  }
</style>
</head>
<body>

  
  <!-- Enhanced Bottom Counter -->
  <div id="bottom-counter">
    <div class="eye-icon">
      <svg viewBox="0 0 24 24">
        <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
      </svg>
    </div>
    <span>Live Viewers: <span id="viewersCount">0</span></span>
  </div>
</div>

<!-- Clappr Init -->
<script>
  var source = 'https://live.helloxsports.xyz/hls/test.m3u8';
  var player = new Clappr.Player({
      source: source,
      parentId: "#player-wrapper",
      autoPlay: true,
      height: "100%",
      width: "100%",
      plugins: [LevelSelector, CDNByeClapprPlugin],
      watermark: "",
      watermarkLink: "https://hellosports.live",
      watermarkPosition: "top-right",
      levelSelectorConfig: {
          labels: { '360p': '', '480p': '', '720p': '', '1080p': '' },
          labelCallback: (levelName, level) => `${level.height}p`
      },
      playback: {
          hlsjsConfig: {
              p2pConfig: {
                  live: true,
                  logLevel: 'debug'
              }
          }
      }
  });
</script>

<!-- Firebase (separate module) -->
<script type="module">
import { getDatabase, ref, onValue, set, serverTimestamp, push, onDisconnect, remove } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";

const firebaseConfig = {
  apiKey: "AIzaSyAOCB5-mOq3j22bSyQGkOG1uO6Q-sejPGo",
  authDomain: "fire-9e9e1.firebaseapp.com",
  databaseURL: "https://fire-9e9e1-default-rtdb.firebaseio.com",
  projectId: "fire-9e9e1",
  storageBucket: "fire-9e9e1.firebasestorage.app",
  messagingSenderId: "228308733237",
  appId: "1:228308733237:web:ea379f622b9128b798907c",
  measurementId: "G-SRNVZJJ3X2"
};

// Init Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// Reference to live viewers
const viewersRef = ref(db, "liveViewers");

// Add current viewer
const newViewerRef = push(viewersRef);
set(newViewerRef, {
  joinedAt: serverTimestamp()
});

// ‚ùå Remove this viewer when they disconnect
onDisconnect(newViewerRef).remove();

// Count viewers and update both counters
onValue(viewersRef, (snapshot) => {
  const count = snapshot.size || 0;  // snapshot.size works for DataSnapshots in v9
  document.getElementById("viewersCount").innerText = count;
  document.getElementById("liveViewers").innerText = count;
});
</script>
</body>
</html>
